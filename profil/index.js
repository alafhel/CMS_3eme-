const state={fiatAvailable:250,invested:1250,assets:[{symbol:'BTC',name:'Bitcoin',amount:0.025,priceEUR:42000,change24h:1.8},{symbol:'ETH',name:'Ethereum',amount:0.6,priceEUR:3200,change24h:-2.4},{symbol:'USDT',name:'Tether',amount:150,priceEUR:1,change24h:0.0}],tx:[]}
const fmt=n=>n.toLocaleString('fr-FR',{minimumFractionDigits:2,maximumFractionDigits:2})+' €'
function computeTotals(){const aVal=state.assets.reduce((s,a)=>s+a.amount*a.priceEUR,0);const total=state.fiatAvailable+aVal;return{aVal,total}}
function renderPortfolio(){const t=computeTotals();document.getElementById('total-portfolio').textContent=fmt(t.total);document.getElementById('available-amt').textContent=fmt(state.fiatAvailable);document.getElementById('invested-amt').textContent=fmt(state.invested);document.getElementById('total-amt-main').textContent=fmt(t.total);const tbody=document.getElementById('assetsTable');tbody.innerHTML='';state.assets.forEach(a=>{const tr=document.createElement('tr');const val=a.amount*a.priceEUR;tr.innerHTML=`<td><div class='asset-name'><div class='coin coin-${a.symbol.toLowerCase()}'>${a.symbol[0]}</div><div><div style='font-weight:700'>${a.name} <span style='color:var(--muted);font-weight:600'>${a.symbol}</span></div><div style='font-size:12px;color:var(--muted)'>Quantité: ${a.amount}</div></div></div></td><td>${a.amount}</td><td>${a.priceEUR.toLocaleString('fr-FR')} €</td><td>${val.toLocaleString('fr-FR',{minimumFractionDigits:2,maximumFractionDigits:2})} €</td><td class='${a.change24h>=0?'positive':'negative'}'>${a.change24h}%</td>`;tbody.appendChild(tr)});const txList=document.getElementById('txList');txList.innerHTML='';if(state.tx.length===0){txList.innerHTML='<div style="color:var(--muted)">Aucune transaction récente.</div>'}else{state.tx.slice().reverse().forEach(t=>{const div=document.createElement('div');div.className='tx';div.innerHTML=`<div><div style='font-weight:700'>${t.type}</div><div class='meta'>${t.date} · ${t.note||''}</div></div><div style='font-weight:700'>${t.amountDisplay}</div>`;txList.appendChild(div)})}}
const modal=document.getElementById('modalBackdrop');document.getElementById('addFundsBtn').onclick=()=>modal.style.display='flex';document.getElementById('cancelModal').onclick=()=>modal.style.display='none';document.getElementById('quickAddBtn').onclick=()=>{state.fiatAvailable+=100;state.tx.push({type:'Dépôt',date:new Date().toLocaleString(),amount:100,amountDisplay:fmt(100),note:'Ajout rapide'});renderPortfolio()};document.getElementById('confirmAdd').onclick=()=>{const cur=document.getElementById('currencySelect').value;const raw=parseFloat(document.getElementById('amountInput').value);const target=document.getElementById('targetAsset').value;if(!raw||raw<=0){alert('Entrer un montant valide');return}if(cur==='EUR'&&target==='AVAILABLE'){state.fiatAvailable+=raw;state.tx.push({type:'Dépôt EUR',date:new Date().toLocaleString(),amount:raw,amountDisplay:fmt(raw),note:'Ajout EUR vers disponible'})}else if(cur==='EUR'&&(target==='BTC'||target==='ETH'||target==='USDT')){const asset=state.assets.find(a=>a.symbol===target);if(asset){const bought=raw/asset.priceEUR;asset.amount+=bought;state.invested+=raw;state.tx.push({type:`Achat ${asset.symbol}`,date:new Date().toLocaleString(),amount:bought,amountDisplay:`${bought.toFixed(8)} ${asset.symbol}`,note:`Dépensé ${fmt(raw)}`})}}else if(cur==='BTC'||cur==='ETH'||cur==='USDT'){const asset=state.assets.find(a=>a.symbol===cur);if(asset){asset.amount+=raw;const valInEUR=raw*asset.priceEUR;state.invested+=valInEUR;state.tx.push({type:`Transfert ${cur}`,date:new Date().toLocaleString(),amount:raw,amountDisplay:`${raw} ${cur}`,note:`Valeur ${fmt(valInEUR)}`})}}modal.style.display='none';document.getElementById('amountInput').value='';renderPortfolio()};document.getElementById('refreshBtn').onclick=()=>{state.assets.forEach(a=>{const pct=(Math.random()*6-3);a.change24h=Number((a.change24h+pct).toFixed(2));a.priceEUR=Number((a.priceEUR*(1+pct/100)).toFixed(2))});renderPortfolio()};renderPortfolio();